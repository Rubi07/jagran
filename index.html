<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü + ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶æ‡¶∞</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 16px;
            background: #f0f2f5;
            color: #1e2b37;
        }
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #0b3b5c;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .tab-btn {
            background: white;
            border: none;
            padding: 12px 28px;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: 0.2s;
            border: 1px solid transparent;
        }
        .tab-btn.active {
            background: #0b3b5c;
            color: white;
            box-shadow: 0 8px 14px rgba(11,59,92,0.2);
            border-color: #0b3b5c;
        }
        .tab-content {
            display: none;
            background: white;
            border-radius: 28px;
            padding: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        .tab-content.active {
            display: block;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .form-row input, .form-row select, .form-row button {
            padding: 14px 18px;
            border: 1px solid #d0d9e4;
            border-radius: 40px;
            font-size: 1rem;
            flex: 1 0 180px;
        }
        .form-row button {
            background: #0b3b5c;
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            flex: 0 0 auto;
        }
        .form-row button:hover {
            background: #0a2e44;
        }
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            background: #f8faff;
            padding: 16px 20px;
            border-radius: 50px;
        }
        .contact-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 18px 22px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
            border: 1px solid #e7edf4;
            transition: 0.15s;
        }
        .contact-card:hover {
            border-color: #0b3b5c;
            box-shadow: 0 8px 18px rgba(11,59,92,0.08);
        }
        .checkbox {
            flex-shrink: 0;
        }
        .checkbox input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .contact-info {
            flex: 1;
            line-height: 1.7;
        }
        .contact-info strong {
            font-size: 1.2rem;
            color: #0b3b5c;
        }
        .contact-info .details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 5px;
            color: #2e4c6b;
            font-size: 0.95rem;
        }
        .contact-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 40px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid transparent;
            transition: 0.2s;
            cursor: pointer;
            background: white;
        }
        .btn-call { background: #3498db; color: white; }
        .btn-wa { background: #25D366; color: white; }
        .btn-edit { background: #f39c12; color: white; }
        .btn-delete { background: #e74c3c; color: white; }
        .btn-export { background: #27ae60; color: white; border: none; }
        .btn-outline { background: transparent; border: 1px solid #0b3b5c; color: #0b3b5c; }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .form-card {
            background: #f8faff;
            border-radius: 18px;
            padding: 18px;
            border: 1px solid #dde3ec;
        }
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            border-radius: 32px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .password-modal {
            background: white;
            border-radius: 32px;
            padding: 30px;
            text-align: center;
        }
        .hidden { display: none; }
        .small-note { color: #6c7a8d; font-size: 0.85rem; margin-top: 5px; }
        .response-item {
            background: #f0f5fa;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü + ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶æ‡¶∞</h1>

    <!-- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="contacts">üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü</button>
        <button class="tab-btn" data-tab="forms">üìã ‡¶´‡¶∞‡ßç‡¶Æ‡¶∏‡¶Æ‡ßÇ‡¶π</button>
        <button class="tab-btn" data-tab="admin">üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</button>
    </div>

    <!-- ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
    <div id="tab-contacts" class="tab-content active">
        <div class="form-row">
            <input type="text" id="name" placeholder="‡¶®‡¶æ‡¶Æ *">
            <input type="text" id="mobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ (‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶®, ‡¶á‡¶â‡¶®‡¶ø‡¶ï) *">
            <input type="text" id="village" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ/‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            <input type="text" id="note" placeholder="‡¶®‡ßã‡¶ü">
            <button id="addContactBtn">‚ûï ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <div class="toolbar">
            <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="selectAllContacts"> ‡¶∏‡¶¨ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®
            </label>
            <button id="whatsappSelectedBtn" class="btn btn-wa">üí¨ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§‡¶¶‡ßá‡¶∞ WhatsApp</button>
            <button id="exportContactsBtn" class="btn btn-export">üì• CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
        </div>

        <div id="contactsList"></div>
    </div>

    <!-- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
    <div id="tab-forms" class="tab-content">
        <div class="form-row">
            <input type="text" id="formTitle" placeholder="‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
            <select id="formFields">
                <option value="name,mobile,note">‡¶®‡¶æ‡¶Æ + ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ + ‡¶®‡ßã‡¶ü (‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßç‡¶°)</option>
                <option value="name,mobile,address,message">‡¶®‡¶æ‡¶Æ, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤, ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ, ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ</option>
            </select>
            <button id="createFormBtn">‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø</button>
        </div>
        <div id="formsList"></div>
    </div>

    <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ (‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶ü‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°) -->
    <div id="tab-admin" class="tab-content">
        <div id="adminLogin" class="password-modal">
            <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
            <input type="password" id="adminPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
            <button id="loginAdminBtn">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <p class="small-note">‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°: admin123</p>
        </div>
        <div id="adminPanel" class="hidden">
            <div class="tabs" style="margin-top: 0;">
                <button class="admin-subtab active" data-subtab="manage-contacts">üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</button>
                <button class="admin-subtab" data-subtab="manage-forms">üìã ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ì ‡¶°‡ßá‡¶ü‡¶æ</button>
            </div>
            <div id="admin-contacts" class="admin-subtab-content active">
                <h3>‡¶∏‡¶ï‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü (‡¶è‡¶°‡¶ø‡¶ü/‡¶°‡¶ø‡¶≤‡¶ø‡¶ü)</h3>
                <div id="adminContactsList"></div>
            </div>
            <div id="admin-forms" class="admin-subtab-content hidden">
                <h3>‡¶´‡¶∞‡ßç‡¶Æ ‡¶ì ‡¶ú‡¶Æ‡¶æ‡¶ï‡ßÉ‡¶§ ‡¶°‡ßá‡¶ü‡¶æ</h3>
                <div id="adminFormsList"></div>
            </div>
        </div>
    </div>

    <!-- ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶∞‡ßç‡¶Æ ‡¶≠‡¶ø‡¶â (‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, URL-‡¶è form= ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) -->
    <div id="publicFormView" class="hidden" style="background: white; border-radius: 32px; padding: 30px; margin-top: 20px;">
        <h2 id="publicFormTitle">‡¶´‡¶∞‡ßç‡¶Æ</h2>
        <div id="publicFormFields"></div>
        <button id="submitPublicForm">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
        <p id="publicFormMessage"></p>
    </div>

    <script>
        (function() {
            // ---------- ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ï‡ßÄ ----------
            const STORAGE_CONTACTS = 'contacts';
            const STORAGE_FORMS = 'customForms';      // { id, title, fields, createdAt }
            const STORAGE_RESPONSES = 'formResponses'; // { formId, responses: [ { ... } ] }

            // ---------- ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ----------
            let contacts = [];
            let forms = [];
            let formResponses = {}; // key: formId, value: array of responses

            // ---------- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£‡ßÄ‡¶ï‡¶∞‡¶£ ----------
            let isAdminLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';

            // ---------- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ----------
            function loadData() {
                contacts = JSON.parse(localStorage.getItem(STORAGE_CONTACTS)) || [];
                forms = JSON.parse(localStorage.getItem(STORAGE_FORMS)) || [];
                formResponses = JSON.parse(localStorage.getItem(STORAGE_RESPONSES)) || {};
                // migrate old format if needed
            }
            function saveContacts() { localStorage.setItem(STORAGE_CONTACTS, JSON.stringify(contacts)); }
            function saveForms() { localStorage.setItem(STORAGE_FORMS, JSON.stringify(forms)); }
            function saveResponses() { localStorage.setItem(STORAGE_RESPONSES, JSON.stringify(formResponses)); }

            // ---------- ‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶Ø‡¶º‡¶æ‡¶® ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® (‡¶á‡¶â‡¶®‡¶ø‡¶ï) ----------
            function isValidIndianMobile(mobile) {
                const cleaned = mobile.replace(/\s+/g, '');
                // +91 followed by 10 digits, or exactly 10 digits
                return /^(\+91|0)?[6-9]\d{9}$/.test(cleaned);
            }
            function isMobileUnique(mobile, excludeId = null) {
                const cleaned = mobile.replace(/\s+/g, '');
                return !contacts.some(c => c.mobile.replace(/\s+/g, '') === cleaned && c.id !== excludeId);
            }

            // ---------- ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® (‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï) ----------
            function openWhatsAppForContacts(contactArray) {
                contactArray.forEach((c, idx) => {
                    let number = c.mobile.replace(/\s+/g, '');
                    if (number.startsWith('+')) number = number.substring(1);
                    setTimeout(() => {
                        window.open(`https://wa.me/${encodeURIComponent(number)}`, '_blank');
                    }, idx * 500);
                });
            }

            // ---------- ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü) ----------
            function renderContacts() {
                const container = document.getElementById('contactsList');
                if (!container) return;
                if (contacts.length === 0) {
                    container.innerHTML = '<div class="empty">üì≠ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á</div>';
                    return;
                }
                let html = '';
                contacts.forEach(c => {
                    html += `
                        <div class="contact-card">
                            <div class="checkbox"><input type="checkbox" class="contact-chk" data-id="${c.id}"></div>
                            <div class="contact-info">
                                <strong>${escapeHtml(c.name)}</strong>
                                <div class="details">
                                    <span>üìû ${escapeHtml(c.mobile)}</span>
                                    <span>üè† ${escapeHtml(c.village || '‚Äî')}</span>
                                    <span>üìù ${escapeHtml(c.note || '‚Äî')}</span>
                                </div>
                            </div>
                            <div class="contact-actions">
                                <a href="tel:${encodeURIComponent(c.mobile)}" class="btn btn-call">üìû ‡¶ï‡¶≤</a>
                                <a href="https://wa.me/${encodeURIComponent(c.mobile.replace(/\s+/g,'').replace(/\+/g,''))}" target="_blank" class="btn btn-wa">üí¨ WhatsApp</a>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                document.getElementById('selectAllContacts').checked = false;
            }

            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶è‡¶°‡¶ø‡¶ü/‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶∏‡¶π)
            function renderAdminContacts() {
                const container = document.getElementById('adminContactsList');
                if (!container) return;
                if (contacts.length === 0) { container.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>'; return; }
                let html = '';
                contacts.forEach(c => {
                    html += `
                        <div class="contact-card" style="margin-bottom:8px;">
                            <div class="contact-info">
                                <strong>${escapeHtml(c.name)}</strong> - ${escapeHtml(c.mobile)}<br>
                                <span>üè† ${escapeHtml(c.village||'')} | üìù ${escapeHtml(c.note||'')}</span>
                            </div>
                            <div class="contact-actions">
                                <button class="btn btn-edit" onclick="editContactPrompt(${c.id})">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                                <button class="btn btn-delete" onclick="deleteContact(${c.id})">üóëÔ∏è ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }

            // ---------- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ----------
            function renderForms() {
                const container = document.getElementById('formsList');
                if (!container) return;
                if (forms.length === 0) {
                    container.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡ßá‡¶á‡•§ ‡¶â‡¶™‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                    return;
                }
                let html = '<div class="card-grid">';
                forms.forEach(f => {
                    const formLink = `${window.location.origin}${window.location.pathname}?form=${f.id}`;
                    html += `
                        <div class="form-card">
                            <h3>${escapeHtml(f.title)}</h3>
                            <p>‡¶´‡¶ø‡¶≤‡ßç‡¶°: ${f.fields}</p>
                            <button class="btn btn-outline" onclick="copyToClipboard('${formLink}')">üîó ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø</button>
                            <p class="small-note">${formLink}</p>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            }

            function renderAdminForms() {
                const container = document.getElementById('adminFormsList');
                if (!container) return;
                if (forms.length === 0) {
                    container.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡ßá‡¶á‡•§</p>';
                    return;
                }
                let html = '';
                forms.forEach(f => {
                    const responses = formResponses[f.id] || [];
                    html += `<div class="form-card" style="margin-bottom:20px;">
                        <h3>${escapeHtml(f.title)}</h3>
                        <p>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ: ${responses.length}</p>
                        <button class="btn btn-outline" onclick="viewFormResponses('${f.id}')">‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                        <button class="btn btn-delete" onclick="deleteForm('${f.id}')">‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                    </div>`;
                });
                container.innerHTML = html;
            }

            // ---------- ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ----------
            function showPublicForm(formId) {
                const form = forms.find(f => f.id == formId);
                if (!form) {
                    document.getElementById('publicFormView').innerHTML = '<p>‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶®‡¶Ø‡¶º‡•§</p>';
                    return;
                }
                document.getElementById('publicFormTitle').innerText = form.title;
                const fieldsContainer = document.getElementById('publicFormFields');
                const fieldNames = form.fields.split(',');
                let fieldHtml = '';
                fieldNames.forEach(fld => {
                    const label = fld.trim();
                    fieldHtml += `<div style="margin-bottom:15px;">
                        <label>${label.charAt(0).toUpperCase()+label.slice(1)}</label><br>
                        <input type="text" id="pub_${label}" placeholder="${label}" style="width:100%; padding:12px; border-radius:30px; border:1px solid #ccc;">
                    </div>`;
                });
                fieldsContainer.innerHTML = fieldHtml;
                document.getElementById('submitPublicForm').onclick = () => {
                    const response = {};
                    fieldNames.forEach(fld => {
                        const val = document.getElementById(`pub_${fld.trim()}`).value;
                        response[fld.trim()] = val;
                    });
                    // ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
                    if (!formResponses[form.id]) formResponses[form.id] = [];
                    formResponses[form.id].push({ ...response, submittedAt: new Date().toISOString() });
                    saveResponses();
                    document.getElementById('publicFormMessage').innerText = '‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
                    fieldsContainer.innerHTML = '';
                };
            }

            // ---------- ‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶æ‡¶∞ ----------
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe.replace(/[&<>"']/g, function(m) {
                    if(m === '&') return '&amp;'; if(m === '<') return '&lt;'; if(m === '>') return '&gt;';
                    if(m === '"') return '&quot;'; return '&#039;';
                });
            }
            window.copyToClipboard = (text) => {
                navigator.clipboard?.writeText(text).then(() => alert('‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!'));
            };

            // ---------- ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ----------
            window.deleteContact = (id) => {
                if (confirm('‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?')) {
                    contacts = contacts.filter(c => c.id !== id);
                    saveContacts();
                    renderContacts();
                    if (isAdminLoggedIn) renderAdminContacts();
                }
            };
            window.editContactPrompt = (id) => {
                const contact = contacts.find(c => c.id === id);
                if (!contact) return;
                const newName = prompt('‡¶®‡¶æ‡¶Æ', contact.name);
                if (newName === null) return;
                const newMobile = prompt('‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤', contact.mobile);
                if (newMobile && isValidIndianMobile(newMobile) && isMobileUnique(newMobile, id)) {
                    contact.name = newName;
                    contact.mobile = newMobile;
                    contact.village = prompt('‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ', contact.village) || contact.village;
                    contact.note = prompt('‡¶®‡ßã‡¶ü', contact.note) || contact.note;
                    saveContacts();
                    renderContacts();
                    renderAdminContacts();
                } else alert('‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶á‡¶®‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶° ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶Ü‡¶õ‡ßá‡•§');
            };

            // ---------- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶® ----------
            function updateAdminUI() {
                if (isAdminLoggedIn) {
                    document.getElementById('adminLogin').classList.add('hidden');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    renderAdminContacts();
                    renderAdminForms();
                } else {
                    document.getElementById('adminLogin').classList.remove('hidden');
                    document.getElementById('adminPanel').classList.add('hidden');
                }
            }

            // ---------- ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ----------
            document.addEventListener('DOMContentLoaded', () => {
                loadData();

                // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶∏‡ßÅ‡¶á‡¶ö‡¶ø‡¶Ç
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', e => {
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        document.getElementById(`tab-${btn.dataset.tab}`).classList.add('active');
                    });
                });

                // ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó
                document.getElementById('addContactBtn').addEventListener('click', () => {
                    const name = document.getElementById('name').value.trim();
                    const mobile = document.getElementById('mobile').value.trim();
                    const village = document.getElementById('village').value.trim();
                    const note = document.getElementById('note').value.trim();
                    if (!name || !mobile) { alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï'); return; }
                    if (!isValidIndianMobile(mobile)) { alert('‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶® ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶® (+91 ‡¶¨‡¶æ 10 ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)'); return; }
                    if (!isMobileUnique(mobile)) { alert('‡¶è‡¶á ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶Ü‡¶õ‡ßá!'); return; }
                    contacts.push({ id: Date.now(), name, mobile, village, note });
                    saveContacts();
                    renderContacts();
                    document.getElementById('name').value = ''; document.getElementById('mobile').value = ''; document.getElementById('village').value = ''; document.getElementById('note').value = '';
                });

                // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶Ö‡¶≤
                document.getElementById('selectAllContacts').addEventListener('change', e => {
                    document.querySelectorAll('.contact-chk').forEach(cb => cb.checked = e.target.checked);
                });

                // ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°
                document.getElementById('whatsappSelectedBtn').addEventListener('click', () => {
                    const selectedIds = Array.from(document.querySelectorAll('.contact-chk:checked')).map(cb => Number(cb.dataset.id));
                    const selectedContacts = contacts.filter(c => selectedIds.includes(c.id));
                    if (selectedContacts.length === 0) { alert('‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø'); return; }
                    openWhatsAppForContacts(selectedContacts);
                });

                // CSV ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü
                document.getElementById('exportContactsBtn').addEventListener('click', () => {
                    if (contacts.length === 0) return;
                    const headers = ['‡¶®‡¶æ‡¶Æ','‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤','‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ','‡¶®‡ßã‡¶ü'];
                    const rows = contacts.map(c => [c.name, c.mobile, c.village||'', c.note||'']);
                    const csv = [headers, ...rows].map(row => row.map(cell => `"${cell.replace(/"/g,'""')}"`).join(',')).join('\n');
                    const blob = new Blob(['\uFEFF' + csv], {type: 'text/csv;charset=utf-8;'});
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'contacts_backup.csv';
                    link.click();
                });

                // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø
                document.getElementById('createFormBtn').addEventListener('click', () => {
                    const title = document.getElementById('formTitle').value.trim();
                    const fields = document.getElementById('formFields').value;
                    if (!title) { alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®'); return; }
                    const newForm = { id: Date.now(), title, fields, createdAt: new Date().toISOString() };
                    forms.push(newForm);
                    saveForms();
                    renderForms();
                    document.getElementById('formTitle').value = '';
                });

                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®
                document.getElementById('loginAdminBtn').addEventListener('click', () => {
                    const pwd = document.getElementById('adminPassword').value;
                    if (pwd === 'admin123') {
                        isAdminLoggedIn = true;
                        sessionStorage.setItem('adminLoggedIn', 'true');
                        updateAdminUI();
                    } else alert('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤');
                });

                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡¶æ‡¶¨ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨
                document.querySelectorAll('.admin-subtab').forEach(btn => {
                    btn.addEventListener('click', e => {
                        document.querySelectorAll('.admin-subtab').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        document.querySelectorAll('.admin-subtab-content').forEach(c => c.classList.add('hidden'));
                        document.getElementById(`admin-${btn.dataset.subtab}`).classList.remove('hidden');
                    });
                });

                // ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶∞‡ßç‡¶Æ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç (URL ‡¶ö‡ßá‡¶ï)
                const urlParams = new URLSearchParams(window.location.search);
                const formId = urlParams.get('form');
                if (formId) {
                    document.querySelector('.tabs').style.display = 'none';
                    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                    document.getElementById('publicFormView').classList.remove('hidden');
                    showPublicForm(formId);
                } else {
                    renderContacts();
                    renderForms();
                }

                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® UI ‡¶∏‡ßá‡¶ü
                updateAdminUI();
            });

            // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ
            window.viewFormResponses = (formId) => {
                const responses = formResponses[formId] || [];
                alert(JSON.stringify(responses, null, 2)); // ‡¶∏‡¶π‡¶ú‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            };
            window.deleteForm = (formId) => {
                if (confirm('‡¶´‡¶∞‡ßç‡¶Æ ‡¶ì ‡¶è‡¶∞ ‡¶∏‡¶¨ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) {
                    forms = forms.filter(f => f.id != formId);
                    delete formResponses[formId];
                    saveForms(); saveResponses();
                    renderAdminForms();
                }
            };
        })();
    </script>
</body>
</html>
