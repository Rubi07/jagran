<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü + ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #f4f7fc;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            font-size: 2.2rem;
            color: #1e3c5c;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        .tab-btn {
            background: white;
            border: none;
            padding: 12px 30px;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e3c5c;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: 0.2s;
        }
        .tab-btn.active {
            background: #1e3c5c;
            color: white;
            box-shadow: 0 8px 16px rgba(30,60,92,0.2);
        }
        .tab-content {
            display: none;
            background: white;
            border-radius: 32px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.03);
        }
        .tab-content.active {
            display: block;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }
        .form-row input, .form-row select, .form-row button {
            padding: 14px 20px;
            border: 1px solid #dde2e9;
            border-radius: 40px;
            font-size: 1rem;
            background: white;
        }
        .form-row button {
            background: #1e3c5c;
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            flex: 0 0 auto;
        }
        .form-row button:hover {
            background: #0f2b42;
        }
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 15px 20px;
            background: #f8fafd;
            padding: 16px 22px;
            border-radius: 60px;
            margin-bottom: 25px;
        }
        .search-box {
            flex: 1;
            min-width: 200px;
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #d0d9e5;
            border-radius: 40px;
            padding: 0 20px;
        }
        .search-box input {
            border: none;
            padding: 14px 0 14px 10px;
            width: 100%;
            background: transparent;
            outline: none;
        }
        .contact-card {
            background: white;
            border-radius: 24px;
            padding: 18px 22px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 18px;
            border: 1px solid #e5ecf3;
            transition: 0.15s;
        }
        .contact-card:hover {
            border-color: #1e3c5c;
            box-shadow: 0 6px 14px rgba(30,60,92,0.08);
        }
        .contact-info {
            flex: 1;
            line-height: 1.7;
        }
        .contact-info strong {
            font-size: 1.2rem;
            color: #1e3c5c;
        }
        .contact-info .details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            color: #3b5e7e;
            font-size: 0.95rem;
        }
        .contact-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 40px;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            text-decoration: none;
            background: white;
            border: 1px solid transparent;
        }
        .btn-call { background: #3498db; color: white; }
        .btn-wa { background: #25D366; color: white; }
        .btn-edit { background: #f39c12; color: white; }
        .btn-delete { background: #e74c3c; color: white; }
        .btn-export { background: #27ae60; color: white; border: none; }
        .btn-import { background: #8e44ad; color: white; border: none; }
        .btn-outline { background: transparent; border: 1px solid #1e3c5c; color: #1e3c5c; }
        .admin-section {
            margin-top: 30px;
        }
        .sub-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .sub-tab {
            background: transparent;
            border: none;
            padding: 8px 22px;
            border-radius: 30px;
            font-weight: 600;
            color: #3b5e7e;
            cursor: pointer;
        }
        .sub-tab.active {
            background: #e6edf5;
            color: #1e3c5c;
        }
        .sub-content {
            display: none;
        }
        .sub-content.active {
            display: block;
        }
        .response-table {
            width: 100%;
            border-collapse: collapse;
            background: #f9fcff;
            border-radius: 20px;
            overflow: hidden;
        }
        .response-table th, .response-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #dde5ef;
        }
        .response-table th {
            background: #e2ecf9;
            color: #1e3c5c;
        }
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-card {
            background: white;
            border-radius: 32px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .password-modal {
            text-align: center;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü + ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶´‡¶∞‡ßç‡¶Æ</h1>

    <!-- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="contacts">üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü</button>
        <button class="tab-btn" data-tab="forms">üìã ‡¶´‡¶∞‡ßç‡¶Æ‡¶∏‡¶Æ‡ßÇ‡¶π</button>
        <button class="tab-btn" data-tab="admin">üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</button>
    </div>

    ------------------------------
    <!-- ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
    <div id="tab-contacts" class="tab-content active">
        <!-- ‡¶Ø‡ßã‡¶ó ‡¶´‡¶∞‡ßç‡¶Æ -->
        <div class="form-row">
            <input type="text" id="contactName" placeholder="‡¶®‡¶æ‡¶Æ *">
            <input type="text" id="contactMobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ (‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶®, ‡¶á‡¶â‡¶®‡¶ø‡¶ï) *">
            <input type="text" id="contactVillage" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ/‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            <input type="text" id="contactNote" placeholder="‡¶®‡ßã‡¶ü">
            <button id="addContactBtn">‚ûï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <!-- ‡¶ü‡ßÅ‡¶≤‡¶¨‡¶æ‡¶∞: ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö, ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü, ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü, ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶Ö‡¶™‡¶∂‡¶® -->
        <div class="toolbar">
            <div class="search-box">
                <span>üîç</span>
                <input type="text" id="searchContacts" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤, ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶®‡ßã‡¶ü...">
            </div>
            <label style="display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="selectAllContacts"> ‡¶∏‡¶¨ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®
            </label>
            <button id="whatsappSelectedBtn" class="btn btn-wa">üí¨ WhatsApp (‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°)</button>
            <button id="exportContactsBtn" class="btn btn-export">üì• CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
            <button id="importContactsBtn" class="btn btn-import">üìÇ CSV ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
        </div>

        <!-- ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
        <div id="contactsList"></div>
    </div>

    ------------------------------
    <!-- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
    <div id="tab-forms" class="tab-content">
        <div class="form-row">
            <input type="text" id="formTitle" placeholder="‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
            <select id="formFields">
                <option value="name,mobile,note">‡¶®‡¶æ‡¶Æ + ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ + ‡¶®‡ßã‡¶ü</option>
                <option value="name,mobile,address,message">‡¶®‡¶æ‡¶Æ, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤, ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ, ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ</option>
            </select>
            <button id="createFormBtn">‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø</button>
        </div>
        <div id="formsList"></div>
    </div>

    ------------------------------
    <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
    <div id="tab-admin" class="tab-content">
        <!-- ‡¶≤‡¶ó‡¶á‡¶® ‡¶Ö‡¶Ç‡¶∂ -->
        <div id="adminLogin" class="modal-card password-modal" style="margin:auto; max-width:400px;">
            <h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
            <input type="password" id="adminPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" style="width:100%; padding:14px; margin:15px 0; border-radius:40px; border:1px solid #ccc;">
            <button id="loginAdminBtn" class="btn" style="background:#1e3c5c; color:white; padding:14px 30px;">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <p class="small-note">‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü: admin123</p>
        </div>

        <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ (‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá) -->
        <div id="adminPanel" class="hidden">
            <div class="sub-tabs">
                <button class="sub-tab active" data-sub="admin-contacts">üìá ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</button>
                <button class="sub-tab" data-sub="admin-forms">üìã ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ì ‡¶°‡ßá‡¶ü‡¶æ</button>
            </div>

            <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡¶æ‡¶¨-‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="admin-contacts" class="sub-content active">
                <div class="toolbar" style="margin-top:10px;">
                    <div class="search-box">
                        <span>üîç</span>
                        <input type="text" id="adminSearchContacts" placeholder="‡¶®‡¶æ‡¶Æ/‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤/‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ...">
                    </div>
                </div>
                <div id="adminContactsList"></div>
            </div>

            <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ì ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶∏‡¶æ‡¶¨-‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
            <div id="admin-forms" class="sub-content">
                <div style="margin-bottom:20px;">
                    <select id="adminFormSelector" style="padding:12px; border-radius:40px; width:300px;">
                        <option value="">-- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
                    </select>
                    <div class="search-box" style="display:inline-flex; width:auto; margin-left:15px;">
                        <input type="text" id="searchResponses" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏...">
                    </div>
                </div>
                <div id="adminResponsesList">‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>
            </div>
        </div>
    </div>

    ------------------------------
    <!-- ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶∞‡ßç‡¶Æ ‡¶≠‡¶ø‡¶â (URL ‡¶è ?form= ‡¶Ü‡¶á‡¶°‡¶ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) -->
    <div id="publicFormView" class="hidden" style="background:white; border-radius:32px; padding:30px; margin-top:20px;">
        <h2 id="publicFormTitle"></h2>
        <div id="publicFormFields"></div>
        <button id="submitPublicForm" class="btn" style="background:#1e3c5c; color:white; padding:14px 30px; margin-top:20px;">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
        <p id="publicFormMessage"></p>
    </div>

    <!-- ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ (‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã) -->
    <div id="importModal" class="modal hidden">
        <div class="modal-card">
            <h3>CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <p>‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü: ‡¶®‡¶æ‡¶Æ,‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤,‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ,‡¶®‡ßã‡¶ü (‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡¶æ‡¶á‡¶® ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá)</p>
            <input type="file" id="csvFile" accept=".csv">
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button id="confirmImport" class="btn btn-import">‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                <button id="cancelImport" class="btn btn-outline">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ---------- ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ï‡ßÄ ----------
            const ST_CONTACTS = 'contacts_pro';
            const ST_FORMS = 'forms_pro';
            const ST_RESPONSES = 'responses_pro';

            // ---------- ‡¶°‡ßá‡¶ü‡¶æ ----------
            let contacts = [];
            let forms = [];
            let responses = {}; // key: formId, value: array

            // ---------- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ----------
            function load() {
                contacts = JSON.parse(localStorage.getItem(ST_CONTACTS)) || [];
                forms = JSON.parse(localStorage.getItem(ST_FORMS)) || [];
                responses = JSON.parse(localStorage.getItem(ST_RESPONSES)) || {};
            }
            function saveContacts() { localStorage.setItem(ST_CONTACTS, JSON.stringify(contacts)); }
            function saveForms() { localStorage.setItem(ST_FORMS, JSON.stringify(forms)); }
            function saveResponses() { localStorage.setItem(ST_RESPONSES, JSON.stringify(responses)); }

            // ---------- ‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶® ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ----------
            function isValidIndianMobile(mob) {
                let cleaned = mob.replace(/\s+/g, '');
                return /^(\+91|0)?[6-9]\d{9}$/.test(cleaned);
            }
            function isMobileUnique(mob, excludeId = null) {
                let cleaned = mob.replace(/\s+/g, '');
                return !contacts.some(c => c.mobile.replace(/\s+/g, '') === cleaned && c.id !== excludeId);
            }

            // ---------- ‡¶è‡¶∏‡ßç‡¶ï‡ßá‡¶™ ----------
            function esc(str) {
                if (!str) return '';
                return String(str).replace(/[&<>"]/g, function(m) {
                    if (m === '&') return '&amp;'; if (m === '<') return '&lt;'; if (m === '>') return '&gt;'; if (m === '"') return '&quot;';
                    return m;
                });
            }

            // ---------- ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®) ----------
            let adminLoggedIn = sessionStorage.getItem('adminPro') === 'true';

            // ---------- ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü) ----------
            function renderContacts(filterText = '') {
                let list = document.getElementById('contactsList');
                if (!list) return;
                let filtered = contacts.filter(c => 
                    c.name.toLowerCase().includes(filterText) ||
                    c.mobile.includes(filterText) ||
                    (c.village && c.village.toLowerCase().includes(filterText)) ||
                    (c.note && c.note.toLowerCase().includes(filterText))
                );
                if (filtered.length === 0) {
                    list.innerHTML = '<div class="empty">‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</div>';
                    return;
                }
                let html = '';
                filtered.forEach(c => {
                    html += `<div class="contact-card">
                        <div class="checkbox"><input type="checkbox" class="contact-chk" data-id="${c.id}"></div>
                        <div class="contact-info">
                            <strong>${esc(c.name)}</strong>
                            <div class="details">
                                <span>üìû ${esc(c.mobile)}</span>
                                <span>üè† ${esc(c.village || '‚Äî')}</span>
                                <span>üìù ${esc(c.note || '‚Äî')}</span>
                            </div>
                        </div>
                        <div class="contact-actions">
                            <a href="tel:${encodeURIComponent(c.mobile)}" class="btn btn-call">üìû ‡¶ï‡¶≤</a>
                            <a href="https://wa.me/${encodeURIComponent(c.mobile.replace(/\s+/g,'').replace(/\+/g,''))}" target="_blank" class="btn btn-wa">üí¨ WhatsApp</a>
                        </div>
                    </div>`;
                });
                list.innerHTML = html;
            }

            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ (‡¶è‡¶°‡¶ø‡¶ü/‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶∏‡¶π)
            function renderAdminContacts(filter = '') {
                let container = document.getElementById('adminContactsList');
                if (!container) return;
                let filtered = contacts.filter(c => 
                    c.name.toLowerCase().includes(filter) ||
                    c.mobile.includes(filter) ||
                    (c.village && c.village.toLowerCase().includes(filter)) ||
                    (c.note && c.note.toLowerCase().includes(filter))
                );
                if (filtered.length === 0) {
                    container.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>';
                    return;
                }
                let html = '';
                filtered.forEach(c => {
                    html += `<div class="contact-card">
                        <div class="contact-info">
                            <strong>${esc(c.name)}</strong> - ${esc(c.mobile)}<br>
                            <span>üè† ${esc(c.village||'')} | üìù ${esc(c.note||'')}</span>
                        </div>
                        <div class="contact-actions">
                            <button class="btn btn-edit" onclick="editContact(${c.id})">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                            <button class="btn btn-delete" onclick="deleteContact(${c.id})">üóëÔ∏è ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
            }

            // ---------- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ----------
            function renderForms() {
                let container = document.getElementById('formsList');
                if (!container) return;
                if (forms.length === 0) {
                    container.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡ßá‡¶á‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                    return;
                }
                let html = '<div style="display:grid; gap:16px;">';
                forms.forEach(f => {
                    let link = `${window.location.origin}${window.location.pathname}?form=${f.id}`;
                    html += `<div class="contact-card" style="display:block;">
                        <h3>${esc(f.title)}</h3>
                        <p><strong>‡¶´‡¶ø‡¶≤‡ßç‡¶°:</strong> ${f.fields}</p>
                        <button class="btn btn-outline" onclick="copyLink('${link}')">üîó ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø</button>
                        <p class="small-note">${link}</p>
                    </div>`;
                });
                html += '</div>';
                container.innerHTML = html;
            }

            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            function updateFormSelector() {
                let sel = document.getElementById('adminFormSelector');
                if (!sel) return;
                sel.innerHTML = '<option value="">-- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
                forms.forEach(f => {
                    sel.innerHTML += `<option value="${f.id}">${esc(f.title)}</option>`;
                });
            }

            // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            function renderResponses(formId, search = '') {
                let container = document.getElementById('adminResponsesList');
                if (!formId || !responses[formId]) {
                    container.innerHTML = '<p>‡¶è‡¶á ‡¶´‡¶∞‡ßç‡¶Æ‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶™‡¶°‡¶º‡ßá‡¶®‡¶ø‡•§</p>';
                    return;
                }
                let data = responses[formId].filter(r => JSON.stringify(r).toLowerCase().includes(search.toLowerCase()));
                if (data.length === 0) {
                    container.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶ø‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>';
                    return;
                }
                let table = '<table class="response-table"><tr>';
                // ‡¶π‡ßá‡¶°‡¶æ‡¶∞
                let fields = Object.keys(data[0]);
                fields.forEach(f => table += `<th>${esc(f)}</th>`);
                table += '</tr>';
                data.forEach(row => {
                    table += '<tr>';
                    fields.forEach(f => table += `<td>${esc(row[f])}</td>`);
                    table += '</tr>';
                });
                table += '</table>';
                container.innerHTML = table;
            }

            // ---------- ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ----------
            document.addEventListener('DOMContentLoaded', function() {
                load();

                // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶∏‡ßÅ‡¶á‡¶ö‡¶ø‡¶Ç
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        document.getElementById(`tab-${this.dataset.tab}`).classList.add('active');
                        // ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶∞‡ßç‡¶Æ ‡¶≠‡¶ø‡¶â ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶ì
                        if (this.dataset.tab !== 'public') {
                            document.getElementById('publicFormView').classList.add('hidden');
                        }
                    });
                });

                // ---------- ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ----------
                document.getElementById('addContactBtn').addEventListener('click', function() {
                    let name = document.getElementById('contactName').value.trim();
                    let mobile = document.getElementById('contactMobile').value.trim();
                    let village = document.getElementById('contactVillage').value.trim();
                    let note = document.getElementById('contactNote').value.trim();
                    if (!name || !mobile) { alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï'); return; }
                    if (!isValidIndianMobile(mobile)) { alert('‡¶á‡¶®‡ßç‡¶°‡¶ø‡ßü‡¶æ‡¶® ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¶‡¶ø‡¶® (+91/0 ‡¶õ‡¶æ‡ßú‡¶æ 10 ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)'); return; }
                    if (!isMobileUnique(mobile)) { alert('‡¶è‡¶á ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶Ü‡¶õ‡ßá!'); return; }
                    contacts.push({ id: Date.now(), name, mobile, village, note });
                    saveContacts();
                    renderContacts(document.getElementById('searchContacts').value.toLowerCase());
                    document.getElementById('contactName').value = ''; document.getElementById('contactMobile').value = ''; document.getElementById('contactVillage').value = ''; document.getElementById('contactNote').value = '';
                });

                // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö
                document.getElementById('searchContacts').addEventListener('input', function() {
                    renderContacts(this.value.toLowerCase());
                });

                // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶Ö‡¶≤
                document.getElementById('selectAllContacts').addEventListener('change', function(e) {
                    document.querySelectorAll('.contact-chk').forEach(cb => cb.checked = e.target.checked);
                });

                // ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°
                document.getElementById('whatsappSelectedBtn').addEventListener('click', function() {
                    let selected = Array.from(document.querySelectorAll('.contact-chk:checked')).map(cb => Number(cb.dataset.id));
                    let contactsToSend = contacts.filter(c => selected.includes(c.id));
                    if (contactsToSend.length === 0) { alert('‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø'); return; }
                    contactsToSend.forEach((c, idx) => {
                        let num = c.mobile.replace(/\s+/g,'').replace(/\+/g,'');
                        setTimeout(() => window.open(`https://wa.me/${encodeURIComponent(num)}`, '_blank'), idx*500);
                    });
                });

                // CSV ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü
                document.getElementById('exportContactsBtn').addEventListener('click', function() {
                    if (contacts.length === 0) return;
                    let headers = ['‡¶®‡¶æ‡¶Æ','‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤','‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ','‡¶®‡ßã‡¶ü'];
                    let rows = contacts.map(c => [c.name, c.mobile, c.village||'', c.note||'']);
                    let csv = [headers, ...rows].map(row => row.map(cell => `"${cell.replace(/"/g,'""')}"`).join(',')).join('\n');
                    let blob = new Blob(['\uFEFF' + csv], {type: 'text/csv;charset=utf-8;'});
                    let a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'contacts_backup.csv';
                    a.click();
                });

                // CSV ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü (‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶ñ‡ßã‡¶≤‡¶æ)
                document.getElementById('importContactsBtn').addEventListener('click', function() {
                    document.getElementById('importModal').classList.remove('hidden');
                });
                document.getElementById('cancelImport').addEventListener('click', function() {
                    document.getElementById('importModal').classList.add('hidden');
                });
                document.getElementById('confirmImport').addEventListener('click', function() {
                    let file = document.getElementById('csvFile').files[0];
                    if (!file) { alert('‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        let text = e.result;
                        let lines = text.split('\n').filter(l => l.trim() !== '');
                        let imported = 0, skipped = 0;
                        for (let i = 1; i < lines.length; i++) { // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡¶æ‡¶á‡¶® ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶ß‡¶∞‡ßá
                            let parts = lines[i].split(',').map(s => s.replace(/^"|"$/g, '').trim());
                            if (parts.length < 2) continue;
                            let name = parts[0], mobile = parts[1], village = parts[2] || '', note = parts[3] || '';
                            if (name && mobile && isValidIndianMobile(mobile) && isMobileUnique(mobile)) {
                                contacts.push({ id: Date.now() + i, name, mobile, village, note });
                                imported++;
                            } else skipped++;
                        }
                        saveContacts();
                        renderContacts(document.getElementById('searchContacts').value.toLowerCase());
                        alert(`‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: ${imported} ‡¶Ø‡ßã‡¶ó, ${skipped} ‡¶¨‡¶æ‡¶¶ (‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü/‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞)`);
                        document.getElementById('importModal').classList.add('hidden');
                    };
                    reader.readAsText(file, 'UTF-8');
                });

                // ---------- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ----------
                document.getElementById('createFormBtn').addEventListener('click', function() {
                    let title = document.getElementById('formTitle').value.trim();
                    let fields = document.getElementById('formFields').value;
                    if (!title) { alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®'); return; }
                    let newForm = { id: Date.now(), title, fields, createdAt: new Date().toISOString() };
                    forms.push(newForm);
                    saveForms();
                    renderForms();
                    updateFormSelector();
                    document.getElementById('formTitle').value = '';
                });

                // ---------- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ----------
                function setAdminUI() {
                    if (adminLoggedIn) {
                        document.getElementById('adminLogin').classList.add('hidden');
                        document.getElementById('adminPanel').classList.remove('hidden');
                        renderAdminContacts('');
                        updateFormSelector();
                    } else {
                        document.getElementById('adminLogin').classList.remove('hidden');
                        document.getElementById('adminPanel').classList.add('hidden');
                    }
                }
                setAdminUI();

                document.getElementById('loginAdminBtn').addEventListener('click', function() {
                    let pwd = document.getElementById('adminPassword').value;
                    if (pwd === 'admin123') {
                        adminLoggedIn = true;
                        sessionStorage.setItem('adminPro', 'true');
                        setAdminUI();
                    } else alert('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤');
                });

                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡¶æ‡¶¨ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨
                document.querySelectorAll('.sub-tab').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.sub-tab').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
                        document.getElementById(this.dataset.sub).classList.add('active');
                    });
                });

                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö
                document.getElementById('adminSearchContacts').addEventListener('input', function() {
                    renderAdminContacts(this.value.toLowerCase());
                });

                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡¶∞
                document.getElementById('adminFormSelector').addEventListener('change', function() {
                    let formId = this.value;
                    if (formId) {
                        renderResponses(formId, document.getElementById('searchResponses').value.toLowerCase());
                    } else {
                        document.getElementById('adminResponsesList').innerHTML = '‡¶´‡¶∞‡ßç‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®';
                    }
                });

                document.getElementById('searchResponses').addEventListener('input', function() {
                    let formId = document.getElementById('adminFormSelector').value;
                    if (formId) renderResponses(formId, this.value.toLowerCase());
                });

                // ---------- ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶∞‡ßç‡¶Æ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç ----------
                const urlParams = new URLSearchParams(window.location.search);
                const formId = urlParams.get('form');
                if (formId) {
                    document.querySelector('.tabs').style.display = 'none';
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById('publicFormView').classList.remove('hidden');
                    let form = forms.find(f => f.id == formId);
                    if (form) {
                        document.getElementById('publicFormTitle').innerText = form.title;
                        let fields = form.fields.split(',');
                        let html = '';
                        fields.forEach(fld => {
                            html += `<div style="margin-bottom:15px;">
                                <label>${fld.trim()}</label><br>
                                <input type="text" id="pub_${fld.trim()}" style="width:100%; padding:12px; border-radius:30px; border:1px solid #ccc;">
                            </div>`;
                        });
                        document.getElementById('publicFormFields').innerHTML = html;
                        document.getElementById('submitPublicForm').onclick = function() {
                            let response = {};
                            fields.forEach(fld => {
                                response[fld.trim()] = document.getElementById(`pub_${fld.trim()}`).value;
                            });
                            if (!responses[formId]) responses[formId] = [];
                            responses[formId].push({ ...response, submittedAt: new Date().toISOString() });
                            saveResponses();
                            document.getElementById('publicFormMessage').innerText = '‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
                            document.getElementById('publicFormFields').innerHTML = '';
                        };
                    } else {
                        document.getElementById('publicFormView').innerHTML = '<p>‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶®‡ßü</p>';
                    }
                } else {
                    renderContacts('');
                    renderForms();
                }

                // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Ö‡¶®‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá)
                window.deleteContact = function(id) {
                    if (confirm('‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?')) {
                        contacts = contacts.filter(c => c.id !== id);
                        saveContacts();
                        renderAdminContacts(document.getElementById('adminSearchContacts').value.toLowerCase());
                        renderContacts(document.getElementById('searchContacts').value.toLowerCase());
                    }
                };
                window.editContact = function(id) {
                    let c = contacts.find(c => c.id === id);
                    if (!c) return;
                    let newName = prompt('‡¶®‡¶æ‡¶Æ', c.name);
                    if (newName === null) return;
                    let newMobile = prompt('‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤', c.mobile);
                    if (!newMobile) return;
                    if (!isValidIndianMobile(newMobile)) { alert('‡¶≠‡¶æ‡¶≤‡ßã ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®'); return; }
                    if (!isMobileUnique(newMobile, id)) { alert('‡¶è‡¶á ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶õ‡ßá'); return; }
                    c.name = newName;
                    c.mobile = newMobile;
                    c.village = prompt('‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ', c.village) || c.village;
                    c.note = prompt('‡¶®‡ßã‡¶ü', c.note) || c.note;
                    saveContacts();
                    renderAdminContacts(document.getElementById('adminSearchContacts').value.toLowerCase());
                    renderContacts(document.getElementById('searchContacts').value.toLowerCase());
                };
                window.copyLink = function(link) {
                    navigator.clipboard?.writeText(link).then(() => alert('‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá'));
                };
            });
        })();
    </script>
</body>
</html>
